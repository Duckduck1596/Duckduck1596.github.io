#  FHRP (First Hop Redundancy Protocol) & L2VPN 정리

##  FHRP (First Hop Redundancy Protocol)

###  개념
- 게이트웨이를 이중화하여 장애가 발생해도 네트워크 통신이 끊기지 않도록 하는 기술
- 기본적으로 여러 라우터/스위치 중 하나를 Active 로 두고, 장애 시 자동으로 다른 장비가 게이트웨이 역할을 수행

### 🔹 종류
1. **HSRP (Hot Standby Router Protocol)**
   - Cisco 전용 프로토콜
   - 가상 IP 주소를 사용하여 Active Router / Standby Router 개념으로 동작
   - 우선순위(기본 100)가 가장 높은 라우터가 Active 역할 수행

2. **VRRP (Virtual Router Redundancy Protocol)**
   - IETF 표준 프로토콜 (Cisco, Juniper 등 멀티벤더 지원)
   - Master / Backup 구조
   - 가상 라우터 IP를 통해 이중화 제공

3. **GLBP (Gateway Load Balancing Protocol)**
   - Cisco 독자 프로토콜
   - 단순한 이중화가 아니라, 트래픽 부하 분산(Load Balancing) 기능까지 제공
   - 여러 게이트웨이가 동시에 동작하며, 클라이언트별로 다른 게이트웨이를 지정 가능

---

##  FHRP 동작 방식

### 🔹 HSRP 구조 예시
```plaintext
          [ Host PC ]
          Default GW: 192.168.1.1 (가상 IP)
                 |
        ---------------------
        |                   |
 [Router1]               [Router2]
 (Active, 192.168.1.2)   (Standby, 192.168.1.3)

- Router1 장애 발생 시 → Router2가 Active로 승격
```

### 🔹 VRRP 구조 예시
```plaintext
          [ Host PC ]
          Default GW: 192.168.1.1 (가상 IP)
                 |
        ---------------------
        |                   |
 [Router1]               [Router2]
 (Master)                (Backup)

- Router1 장애 발생 시 → Router2가 Master로 승격
```

### 🔹 GLBP 구조 예시
```plaintext
          [ Host1 ]----+
          [ Host2 ]----+ Default GW: 192.168.1.1 (가상 IP)
          [ Host3 ]----+
                       |
        ---------------------------------------
        |                  |                  |
 [Router1]            [Router2]           [Router3]
 (Active Virtual GW)  (Backup1)           (Backup2)

- Host1 → Router1 게이트웨이 사용
- Host2 → Router2 게이트웨이 사용
- Host3 → Router3 게이트웨이 사용
(트래픽 부하분산 효과)
```

---

## L2VPN (Layer 2 VPN)

###  개념
- L2(Frame 기반)를 터널링하는 VPN 기술
- MAC 프레임 단위의 통신을 ISP 망을 통해 다른 지점까지 연결하는 가상 사설망
- 마치 동일한 LAN 스위치에 연결된 것처럼 원거리 지점 간 L2 연결을 제공

### 🔹 활용 사례
- **지사와 본사를 같은 VLAN처럼 연결하고 싶을 때**
- **VM이나 서버 간 L2 통신이 필요할 때**
- **기존 L2 기반 프로토콜을 유지하며 통신하고 싶을 때** (STP, CDP, VTP 등)
- **MPLS, VXLAN, GRE 등과 결합해 고성능 통신이 필요할 때**

---

## 주요 프로토콜

### 🔹 GRE (Generic Routing Encapsulation)
- Cisco가 개발한 터널링 프로토콜
- IP 패킷 안에 다른 프로토콜 패킷을 캡슐화하여 전달
- 단순하고 범용적 → IP, IPv6, Multicast, Routing Protocol 등을 모두 터널링 가능
- 보안 기능은 없고, 주로 IPSec과 결합해 사용

#### GRE 동작 그림
```plaintext
 [PC1] --- [RouterA] ===================== [RouterB] --- [PC2]
               | GRE 터널 (가상 회선) |

원본 패킷(IP) → [GRE 캡슐화] → IP 헤더 + GRE 헤더 + 원본 패킷 → [RouterB에서 디캡슐화] → 원본 패킷 전달
```

---

### 🔹 MPLS (Multiprotocol Label Switching)
- ISP 백본망에서 많이 사용되는 기술
- 패킷 전달 시 IP 주소 대신 라벨(Label) 기반으로 고속 전송
- L2/L3 모두 지원하며, QoS, 트래픽 엔지니어링, VPN 등에 활용
- L2VPN 구현 시 VPLS, VPWS 같은 서비스 형태로 제공

#### MPLS 동작 그림
```plaintext
 [PC1] → [Router A] → [Router B] → [Router C] → [PC2]

IP 패킷
   ↓ (Ingress LER에서 라벨 부착)
[Label][IP Packet]
   ↓ (중간 LSR에서 라벨 스위칭)
[Label][IP Packet]
   ↓ (Egress LER에서 라벨 제거)
IP 패킷 도착
```

---

### 🔹 VXLAN (Virtual Extensible LAN)
- 데이터센터 및 클라우드 환경에서 VLAN 확장을 위해 개발
- VLAN ID (12bit, 최대 4096개)의 한계를 넘어, VXLAN ID (24bit, 약 1,600만개) 제공
- L2 프레임을 UDP 캡슐화해 L3 네트워크 상에서 전달
- 대규모 가상화/클라우드 인프라에서 L2 확장을 위한 표준

#### VXLAN 동작 그림
```plaintext
   +--------------------------- L3 Network ----------------------------+
   |                                                                   |
[Host1]---[VTEP A] ================================= [VTEP B]---[Host2]
            (Encap)                                   (Decap)

원본 이더넷 프레임
   ↓ VXLAN 캡슐화
UDP + VXLAN 헤더 + 원본 Ethernet Frame
   ↓ L3 네트워크 전송
VTEP B에서 디캡슐화 → 원본 이더넷 프레임 전달
```

---

##  최종 요약
- **FHRP** : 게이트웨이 이중화 기술
  - Cisco 전용 : HSRP, GLBP
  - 표준 기반 : VRRP
  - GLBP는 이중화 + 부하분산 제공

- **L2VPN** : ISP 망을 통해 Layer 2 프레임을 터널링하여 원거리 지점 간 LAN 연결 지원
  - 활용 사례: 지사-본사 VLAN 연결, VM/서버 간 통신, L2 프로토콜 유지, 대규모 데이터센터 확장
  - 관련 기술: GRE (터널링), MPLS (라벨 스위칭), VXLAN (대규모 가상 네트워크 확장)

